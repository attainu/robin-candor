{"version":3,"sources":["../../src/controller/post.controller.js"],"names":["app","post_controller","createPost","req","res","errors","isEmpty","status","json","array","hitUrl","encodeURIComponent","body","url","category","Post","findOne","err","data","send","msg","tag","post_body","match","entry","post","username","post_tags","save","message","redirect","findOneAndUpdate","console","log","createComment","current_url","post_id","comment_body","comment_username","comment_tags","then","renderPost","decodeURIComponent","query","limit","page","parseInt","endIndex","search_by_username","search_username","sort_likes","aggregate","$match","$unwind","result","total_length","length","$addFields","upvote_count","$size","$sort","$skip","$limit","exec","has_next","next_page","has_prev","prev_page","attach_likes","user","name","render","posts","viewername","getdata","question","admin","related","others","updateLike","like_search_result","add_like","id","upvote_username","delete_like","getTrendingTags","final_result","$group","forEach","element","_id","count","sortable","push","sort","a","b","final_str","slice","i","module","exports","post_outer","user_like","like_count","upvote_users"],"mappings":"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","sourcesContent":["import Post from '../model/post.model';\nimport {validationResult} from 'express-validator';\nimport {ObjectId} from 'mongodb';\n\nconst app = {};\n\nconst post_controller = {\n    createPost: (req, res) => {\n        const errors = validationResult(req);\n        if (!errors.isEmpty()) {\n            return res.status(422).json({errors: errors.array()});\n        }\n        ;\n        let hitUrl = `/post/render?current_url=${encodeURIComponent(req.body.url)}&category=${req.body.category}&page=1`;\n        Post.findOne({url: req.body.url}, (err, data) => {\n            if (err) {\n                res.status(500).send({msg: \"Internal Server Error\"});\n            } else {\n\n                const tag = req.body.post_body.match(/(#[\\w!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]+)/g);\n                if (!data) {\n                    let entry = new Post({\n                        url: req.body.url,\n                        post: [{\n                            username: req.body.username,\n                            category: req.body.category,\n                            post_tags: tag,\n                            post_body: req.body.post_body\n                        }]\n                    });\n                    entry.save(err => {\n                        if (err) {\n                            res.status(406).send(err.message);\n                        } else {\n                            return res.redirect(hitUrl);\n                        }\n                    });\n                } else {\n                    Post.findOneAndUpdate({url: req.body.url},\n                        {\n                            \"$push\": {\n                                \"post\": {\n                                    username: req.body.username,\n                                    category: req.body.category,\n                                    post_tags: tag,\n                                    post_body: req.body.post_body\n                                }\n                            }\n                        }, {\"new\": true},\n                        err => {\n                            if (err) console.log(err);\n                            res.redirect(hitUrl);\n                        }\n                    );\n                }\n            }\n\n        })\n\n    },\n    createComment: (req, res) => {\n\n        let current_url = req.body.url;\n        let post_id = req.body.post_id;\n        const tag = req.body.comment_body.match(/(#[\\w!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]+)/g);\n\n        Post.findOneAndUpdate({url: current_url, \"post._id\": post_id},\n            {\n                \"$push\": {\n                    \"post.$.comments\": {\n                        comment_username: req.body.username,\n                        comment_tags: tag,\n                        comment_body: req.body.comment_body\n                    }\n                }\n            }, {\"new\": true})\n            .then(() => {\n                let hitUrl = `/post/render?current_url=${encodeURIComponent(current_url)}&category=${req.body.category}`;\n                res.redirect(hitUrl)\n            })\n            .catch(err => console.log(err));\n\n    },\n    renderPost: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let category = req.query.category;\n        let limit = 3;\n        let page = parseInt(req.query.page);\n        const endIndex = page * limit;\n        let total_length;\n        let query;\n        let search_by_username = req.query.search_username;\n        let sort_likes = req.query.sort_likes;\n\n        if (sort_likes) {\n            if (search_by_username) {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }, {$addFields: {upvote_count: {$size: \"$post.upvote_users\"}}}, {\n                    $sort: {\n                        \"upvote_count\": -1,\n                        'post.post_time': -1\n                    }\n                }, {$skip: (page - 1) * limit}, {$limit: limit}])\n            } else {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}, {$addFields: {upvote_count: {$size: \"$post.upvote_users\"}}}, {\n                    $sort: {\n                        \"upvote_count\": -1,\n                        'post.post_time': -1\n                    }\n                }, {$skip: (page - 1) * limit}, {$limit: limit}])\n            }\n        } else {\n            if (search_by_username) {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }, {$sort: {'post.post_time': -1}}, {$skip: (page - 1) * limit}, {$limit: limit}])\n            } else {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}, {$sort: {'post.post_time': -1}}, {$skip: (page - 1) * limit}, {$limit: limit}])\n            }\n        }\n\n        query.exec()\n            .then(result => {\n                if (endIndex >= total_length) {\n                    result.has_next = false;\n                } else {\n                    result.has_next = true;\n                    result.next_page = page + 1\n                }\n                if (page === 1) {\n                    result.has_prev = false;\n                } else {\n                    result.has_prev = true;\n                    result.prev_page = page - 1\n                }\n                attach_likes(result, req.user.name);\n\n                res.render('index', {\n                    posts: result,\n                    url: current_url,\n                    viewername: req.user.name,\n                    category,\n                    user: req.user\n                })\n            })\n            .catch(err => console.log(err));\n    },\n    getdata: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let data = {};\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'question'}}]).then(result => {\n            data.question = result.length\n        });\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'admin'}}]).then(result => {\n            data.admin = result.length\n        });\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'related'}}]).then(result => {\n            data.related = result.length\n        });\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'others'}}]).then(result => {\n            data.others = result.length\n        });\n        res.status(200).send(data);\n    },\n    updateLike: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let post_id = req.query.post_id;\n        let like_search_result = {};\n\n        const add_like = (url, id, name) => {\n            Post.findOneAndUpdate({url, \"post._id\": id},\n                {\n                    \"$push\": {\n                        \"post.$.upvote_users\": {\n                            upvote_username: name\n                        }\n                    }\n                }, {\"new\": true})\n                .then((result) => {\n                    res.send('liked');\n                })\n                .catch(err => console.log(err));\n        };\n        const delete_like = (url, id, name) => {\n            Post.findOneAndUpdate({url, \"post._id\": id},\n                {\n                    \"$pull\": {\n                        \"post.$.upvote_users\": {\n                            upvote_username: name\n                        }\n                    }\n                }, {\"new\": true})\n                .then((result) => {\n                    res.send('unliked');\n                })\n                .catch(err => console.log(err));\n        };\n\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post._id': ObjectId(post_id)}}, {$unwind: '$post.upvote_users'}, {$match: {'post.upvote_users.upvote_username': req.user.name}}])\n            .then((result) => {\n                like_search_result[req.user.name] = result;\n                if (like_search_result[req.user.name].length === 0) {\n                    add_like(current_url, post_id, req.user.name);\n                } else {\n                    delete_like(current_url, post_id, req.user.name);\n                }\n                ;\n                delete like_search_result[req.user.name];\n            })\n            .catch(err => console.log(err));\n\n    },\n    getTrendingTags: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let category = req.query.category;\n        let final_result = {};\n        await Post.aggregate([{$match: {url: current_url}},\n            {$unwind: '$post'},\n            {$match: {'post.category': category}},\n            {$match: {'post.post_tags': {\"$exists\": true, \"$ne\": null}}},\n            {$unwind: '$post.post_tags'},\n            {$group: {'_id': {'post_tags': '$post.post_tags'}, 'count': {'$sum': 1}}}])\n            .then(result => {\n                result.forEach(element => {\n                    final_result[element._id.post_tags] = element.count;\n                });\n            })\n            .catch(err => console.log(err))\n\n        await Post.aggregate([{$match: {url: current_url}},\n            {$unwind: '$post'},\n            {$match: {'post.category': category}},\n            {$unwind: '$post.comments'},\n            {$match: {'post.comments.comment_tags': {\"$exists\": true, \"$ne\": null}}},\n            {$unwind: '$post.comments.comment_tags'},\n            {$group: {'_id': {'comment_tags': '$post.comments.comment_tags'}, 'count': {'$sum': 1}}}])\n            .then(result => {\n                    result.forEach(element => {\n                        if (!final_result[element._id.comment_tags]) {\n                            final_result[element._id.comment_tags] = element.count;\n                        } else {\n                            final_result[element._id.comment_tags] += element.count;\n                        }\n                    });\n                    let sortable = [];\n                    for (let result in final_result) {\n                        sortable.push([result, final_result[result]]);\n                    }\n\n                    sortable.sort((a, b) => {\n                        return b[1] - a[1];\n                    });\n                    let final_str = '<ul class=\"list-group\">';\n                    sortable = sortable.slice(0, 10);\n                    for (let i = 0; i < sortable.length; i += 1) {\n                        final_str += '<li class=\"list-group-item d-flex justify-content-between align-items-center\">' +\n                            sortable[i][0] +\n                            `<span class=\"badge badge-primary badge-pill\">${sortable[i][1]}</span></li>`;\n                    }\n                    final_str += '</ul>';\n                    res.send(final_str)\n                }\n            )\n            .catch(err => console.log(err))\n    }\n};\nmodule.exports = {post_controller, app};\n\nfunction attach_likes(result, name) {\n    let post_outer;\n    for (post_outer of result) {\n        post_outer.post.user_like = false;\n        post_outer.post.like_count = post_outer.post.upvote_users.length;\n        let user;\n        for (user of post_outer.post.upvote_users) {\n            if (user.upvote_username === name) {\n                post_outer.post.user_like = true;\n            }\n        }\n    }\n}\n"],"file":"post.controller.js"}