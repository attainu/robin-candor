{"version":3,"sources":["../../src/controller/post.controller.js"],"names":["app","post_controller","createPost","req","res","errors","isEmpty","status","json","array","hitUrl","encodeURIComponent","body","url","category","Post","findOne","err","data","send","msg","tag","post_body","match","entry","post","username","post_tags","save","message","redirect","findOneAndUpdate","console","log","createComment","current_url","post_id","comment_body","comment_username","comment_tags","then","result","renderPost","decodeURIComponent","query","limit","page","parseInt","endIndex","search_by_username","search_username","sort_likes","aggregate","$match","$unwind","total_length","length","$addFields","upvote_count","$size","$sort","$skip","$limit","exec","has_next","next_page","has_prev","prev_page","attach_likes","user","name","render","posts","viewername","getdata","question","admin","related","others","updateLike","like_search_result","add_like","id","upvote_username","delete_like","getTrendingTags","final_result","$group","forEach","element","_id","count","sortable","push","sort","a","b","final_str","slice","i","module","exports","post_outer","user_like","like_count","upvote_users"],"mappings":"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","sourcesContent":["import Post from '../model/post.model';\r\nimport {validationResult} from 'express-validator';\r\nimport {ObjectId} from 'mongodb';\r\n\r\nconst app = {};\r\n\r\nconst post_controller = {\r\n    createPost: (req, res) => {\r\n        const errors = validationResult(req);\r\n        if (!errors.isEmpty()) {\r\n            return res.status(422).json({errors: errors.array()});\r\n        }\r\n        ;\r\n        let hitUrl = `/post/render?current_url=${encodeURIComponent(req.body.url)}&category=${req.body.category}&page=1`;\r\n        Post.findOne({url: req.body.url}, (err, data) => {\r\n            if (err) {\r\n                res.status(500).send({msg: \"Internal Server Error\"});\r\n            } else {\r\n\r\n                const tag = req.body.post_body.match(/(#[\\w!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]+)/g);\r\n                if (!data) {\r\n                    let entry = new Post({\r\n                        url: req.body.url,\r\n                        post: [{\r\n                            username: req.body.username,\r\n                            category: req.body.category,\r\n                            post_tags: tag,\r\n                            post_body: req.body.post_body\r\n                        }]\r\n                    });\r\n                    entry.save(err => {\r\n                        if (err) {\r\n                            res.status(406).send(err.message);\r\n                        } else {\r\n                            return res.redirect(hitUrl);\r\n                        }\r\n                    });\r\n                } else {\r\n                    Post.findOneAndUpdate({url: req.body.url},\r\n                        {\r\n                            \"$push\": {\r\n                                \"post\": {\r\n                                    username: req.body.username,\r\n                                    category: req.body.category,\r\n                                    post_tags: tag,\r\n                                    post_body: req.body.post_body\r\n                                }\r\n                            }\r\n                        }, {\"new\": true},\r\n                        err => {\r\n                            if (err) console.log(err);\r\n                            res.redirect(hitUrl);\r\n                        }\r\n                    );\r\n                }\r\n            }\r\n\r\n        })\r\n\r\n    },\r\n    createComment: (req, res) => {\r\n\r\n        let current_url = req.body.url;\r\n        let post_id = req.body.post_id;\r\n        const tag = req.body.comment_body.match(/(#[\\w!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]+)/g);\r\n\r\n        Post.findOneAndUpdate({url: current_url, \"post._id\": post_id},\r\n            {\r\n                \"$push\": {\r\n                    \"post.$.comments\": {\r\n                        comment_username: req.body.username,\r\n                        comment_tags: tag,\r\n                        comment_body: req.body.comment_body\r\n                    }\r\n                }\r\n            }, {\"new\": true})\r\n            .then((result) => {\r\n                let hitUrl = `/post/render?current_url=${encodeURIComponent(current_url)}&category=${req.body.category}`;\r\n                res.redirect(hitUrl)\r\n            })\r\n            .catch(err => console.log(err));\r\n\r\n    },\r\n    renderPost: async (req, res) => {\r\n        let current_url = decodeURIComponent(req.query.current_url);\r\n        let category = req.query.category;\r\n        let limit = 3;\r\n        let page = parseInt(req.query.page);\r\n        const endIndex = page * limit;\r\n        let total_length;\r\n        let query;\r\n        let search_by_username = req.query.search_username;\r\n        let sort_likes = req.query.sort_likes;\r\n\r\n        if (sort_likes) {\r\n            if (search_by_username) {\r\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\r\n                    $match: {\r\n                        'post.category': category,\r\n                        'post.username': search_by_username\r\n                    }\r\n                }]).then(result => total_length = result.length).catch(err => console.log(err));\r\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\r\n                    $match: {\r\n                        'post.category': category,\r\n                        'post.username': search_by_username\r\n                    }\r\n                }, {$addFields: {upvote_count: {$size: \"$post.upvote_users\"}}}, {\r\n                    $sort: {\r\n                        \"upvote_count\": -1,\r\n                        'post.post_time': -1\r\n                    }\r\n                }, {$skip: (page - 1) * limit}, {$limit: limit}])\r\n            } else {\r\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}]).then(result => total_length = result.length).catch(err => console.log(err));\r\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}, {$addFields: {upvote_count: {$size: \"$post.upvote_users\"}}}, {\r\n                    $sort: {\r\n                        \"upvote_count\": -1,\r\n                        'post.post_time': -1\r\n                    }\r\n                }, {$skip: (page - 1) * limit}, {$limit: limit}])\r\n            }\r\n        } else {\r\n            if (search_by_username) {\r\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\r\n                    $match: {\r\n                        'post.category': category,\r\n                        'post.username': search_by_username\r\n                    }\r\n                }]).then(result => total_length = result.length).catch(err => console.log(err));\r\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\r\n                    $match: {\r\n                        'post.category': category,\r\n                        'post.username': search_by_username\r\n                    }\r\n                }, {$sort: {'post.post_time': -1}}, {$skip: (page - 1) * limit}, {$limit: limit}])\r\n            } else {\r\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}]).then(result => total_length = result.length).catch(err => console.log(err));\r\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}, {$sort: {'post.post_time': -1}}, {$skip: (page - 1) * limit}, {$limit: limit}])\r\n            }\r\n        }\r\n\r\n        query.exec()\r\n            .then(result => {\r\n                if (endIndex >= total_length) {\r\n                    result.has_next = false;\r\n                } else {\r\n                    result.has_next = true;\r\n                    result.next_page = page + 1\r\n                }\r\n                if (page === 1) {\r\n                    result.has_prev = false;\r\n                } else {\r\n                    result.has_prev = true;\r\n                    result.prev_page = page - 1\r\n                }\r\n                attach_likes(result, req.user.name);\r\n\r\n                res.render('index', {\r\n                    posts: result,\r\n                    url: current_url,\r\n                    viewername: req.user.name,\r\n                    category,\r\n                    user: req.user\r\n                })\r\n            })\r\n            .catch(err => console.log(err));\r\n    },\r\n    getdata: async (req, res) => {\r\n        let current_url = decodeURIComponent(req.query.current_url);\r\n        let data = {};\r\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'question'}}]).then(result => {\r\n            data.question = result.length\r\n        });\r\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'admin'}}]).then(result => {\r\n            data.admin = result.length\r\n        });\r\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'related'}}]).then(result => {\r\n            data.related = result.length\r\n        });\r\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'others'}}]).then(result => {\r\n            data.others = result.length\r\n        });\r\n        res.status(200).send(data);\r\n    },\r\n    updateLike: async (req, res) => {\r\n        let current_url = decodeURIComponent(req.query.current_url);\r\n        let post_id = req.query.post_id;\r\n        let like_search_result = {};\r\n\r\n        const add_like = (url, id, name) => {\r\n            Post.findOneAndUpdate({url, \"post._id\": id},\r\n                {\r\n                    \"$push\": {\r\n                        \"post.$.upvote_users\": {\r\n                            upvote_username: name\r\n                        }\r\n                    }\r\n                }, {\"new\": true})\r\n                .then((result) => {\r\n                    res.send('liked');\r\n                })\r\n                .catch(err => console.log(err));\r\n        };\r\n        const delete_like = (url, id, name) => {\r\n            Post.findOneAndUpdate({url, \"post._id\": id},\r\n                {\r\n                    \"$pull\": {\r\n                        \"post.$.upvote_users\": {\r\n                            upvote_username: name\r\n                        }\r\n                    }\r\n                }, {\"new\": true})\r\n                .then((result) => {\r\n                    res.send('unliked');\r\n                })\r\n                .catch(err => console.log(err));\r\n        };\r\n\r\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post._id': ObjectId(post_id)}}, {$unwind: '$post.upvote_users'}, {$match: {'post.upvote_users.upvote_username': req.user.name}}])\r\n            .then((result) => {\r\n                like_search_result[req.user.name] = result;\r\n                if (like_search_result[req.user.name].length === 0) {\r\n                    add_like(current_url, post_id, req.user.name);\r\n                } else {\r\n                    delete_like(current_url, post_id, req.user.name);\r\n                }\r\n                ;\r\n                delete like_search_result[req.user.name];\r\n            })\r\n            .catch(err => console.log(err));\r\n\r\n    },\r\n    getTrendingTags: async (req, res) => {\r\n        let current_url = decodeURIComponent(req.query.current_url);\r\n        let category = req.query.category;\r\n        let final_result = {};\r\n        await Post.aggregate([{$match: {url: current_url}},\r\n            {$unwind: '$post'},\r\n            {$match: {'post.category': category}},\r\n            {$match: {'post.post_tags': {\"$exists\": true, \"$ne\": null}}},\r\n            {$unwind: '$post.post_tags'},\r\n            {$group: {'_id': {'post_tags': '$post.post_tags'}, 'count': {'$sum': 1}}}])\r\n            .then(result => {\r\n                result.forEach(element => {\r\n                    final_result[element._id.post_tags] = element.count;\r\n                });\r\n            })\r\n            .catch(err => console.log(err))\r\n\r\n        await Post.aggregate([{$match: {url: current_url}},\r\n            {$unwind: '$post'},\r\n            {$match: {'post.category': category}},\r\n            {$unwind: '$post.comments'},\r\n            {$match: {'post.comments.comment_tags': {\"$exists\": true, \"$ne\": null}}},\r\n            {$unwind: '$post.comments.comment_tags'},\r\n            {$group: {'_id': {'comment_tags': '$post.comments.comment_tags'}, 'count': {'$sum': 1}}}])\r\n            .then(result => {\r\n                    result.forEach(element => {\r\n                        if (!final_result[element._id.comment_tags]) {\r\n                            final_result[element._id.comment_tags] = element.count;\r\n                        } else {\r\n                            final_result[element._id.comment_tags] += element.count;\r\n                        }\r\n                    });\r\n                    let sortable = [];\r\n                    for (let result in final_result) {\r\n                        sortable.push([result, final_result[result]]);\r\n                    }\r\n\r\n                    sortable.sort((a, b) => {\r\n                        return b[1] - a[1];\r\n                    });\r\n                    let final_str = '<ul class=\"list-group\">';\r\n                    sortable = sortable.slice(0, 10);\r\n                    for (let i = 0; i < sortable.length; i += 1) {\r\n                        final_str += '<li class=\"list-group-item d-flex justify-content-between align-items-center\">' +\r\n                            sortable[i][0] +\r\n                            `<span class=\"badge badge-primary badge-pill\">${sortable[i][1]}</span></li>`;\r\n                    }\r\n                    final_str += '</ul>';\r\n                    res.send(final_str)\r\n                }\r\n            )\r\n            .catch(err => console.log(err))\r\n    }\r\n};\r\nmodule.exports = {post_controller, app};\r\n\r\nfunction attach_likes(result, name) {\r\n    let post_outer;\r\n    for (post_outer of result) {\r\n        post_outer.post.user_like = false;\r\n        post_outer.post.like_count = post_outer.post.upvote_users.length;\r\n        let user;\r\n        for (user of post_outer.post.upvote_users) {\r\n            if (user.upvote_username === name) {\r\n                post_outer.post.user_like = true;\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"file":"post.controller.js"}